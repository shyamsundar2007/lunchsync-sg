# LunchSync SG

Sync bank transactions from Singapore banks to [Lunch Money](https://lunchmoney.app). Parses CSV/XLS exports from multiple banks and uploads them directly via the Lunch Money API.

## Supported Banks

- **OCBC**: Credit Card, 360 Account
- **DBS**: Savings Account, Credit Card
- **UOB**: Lady's Solitaire, Preferred Platinum VISA
- **HSBC**: Revolution Card
- **Citibank**: Rewards, Prestige

## Quick Start

### 1. Install

```bash
# Clone and install
git clone https://github.com/shyamsundar2007/lunchsync-sg.git
cd lunchsync-sg
uv pip install -e .
```

### 2. Download Bank Exports

Download transaction exports from your bank's website:

| Bank | Where to Download |
|------|-------------------|
| OCBC | Internet Banking → Cards/Accounts → Download Statement (CSV) |
| DBS | digibank → Cards/Accounts → Transaction History → Download |
| UOB | Personal Internet Banking → Cards → Download Statement (XLS) |
| HSBC | Online Banking → Credit Cards → Download Transactions |
| Citi | Citibank Online → Cards → Download Transaction History |

Put all downloaded files in a folder (e.g., `~/Downloads/bank-exports/`).

### 3. Set Up Account Mappings

Create a config file to map your account numbers to friendly names:

```bash
mkdir -p ~/.config/lunchsync-sg
nano ~/.config/lunchsync-sg/.env
```

Add your account mappings (get identifiers from your bank export files):

```bash
# Format: account_number:Display Name:Bank:type
ACCOUNT_MAPPINGS=5400123456781234:OCBC Rewards:OCBC:credit_card,695012345678:OCBC 360:OCBC:savings
```

### 4. Get Your Lunch Money API Key

1. Go to [Lunch Money Developers](https://my.lunchmoney.app/developers)
2. Create a new API key
3. Add it to your config file:

```bash
LUNCHMONEY_API_KEY=your_api_key_here
```

### 5. Map Accounts to Lunch Money Assets

Run the interactive setup to map your bank accounts to Lunch Money assets:

```bash
lunchsync-sg --lm-setup
```

This will show your Lunch Money assets and let you map each bank account. The mapping is saved to your config file.

### 6. Upload Transactions

```bash
# Upload all bank exports to Lunch Money
lunchsync-sg ~/Downloads/bank-exports/ --upload-lunchmoney

# Preview what would be uploaded (dry run)
lunchsync-sg ~/Downloads/bank-exports/ --upload-lunchmoney --dry-run
```

## Configuration

Your `~/.config/lunchsync-sg/.env` file should look like:

```bash
# Account mappings (from bank exports)
ACCOUNT_MAPPINGS=5400123456781234:OCBC Rewards:OCBC:credit_card,695012345678:OCBC 360:OCBC:savings,0201234567:DBS Savings:DBS:savings

# Lunch Money API
LUNCHMONEY_API_KEY=your_api_key_here

# Account to Asset mapping (generated by --lm-setup)
LUNCHMONEY_ACCOUNT_MAP=OCBC Rewards=12345|OCBC 360=67890|DBS Savings=11111
```

### Finding Account Identifiers

Open your bank export file and look for the account/card number. Examples:

- OCBC Credit: `5400-1234-5678-1234` (use without dashes: `5400123456781234`)
- OCBC 360: `695-012345-678`
- DBS: `020-1-23456-7`
- UOB: Full card number in the XLS file
- HSBC: Last 4 digits (e.g., `3363`)
- Citi: Full card number

## CLI Reference

```bash
# Upload to Lunch Money
lunchsync-sg ~/Downloads/bank-exports/ --upload-lunchmoney

# Dry run (preview without uploading)
lunchsync-sg ~/Downloads/bank-exports/ --upload-lunchmoney --dry-run

# Export to CSV instead (for manual import)
lunchsync-sg ~/Downloads/bank-exports/ -o transactions.csv

# Export with all fields (currency, category, reference)
lunchsync-sg ~/Downloads/bank-exports/ -o transactions.csv --full

# Interactive Lunch Money setup
lunchsync-sg --lm-setup

# List available bank parsers
lunchsync-sg --list-parsers

# Verbose output
lunchsync-sg ~/Downloads/bank-exports/ --upload-lunchmoney -v
```

## Troubleshooting

### "Unknown (1234)" account names

Your account mapping is missing or incorrect. Check:
1. Config file exists at `~/.config/lunchsync-sg/.env`
2. Account identifier matches what's in your bank export
3. Run with `-v` to see which identifiers are being detected

### Duplicate transactions

The tool automatically deduplicates within a batch. Lunch Money also deduplicates based on the transaction reference. If you're seeing duplicates, they may have different reference numbers.

### Unsupported bank format

Run `lunchsync-sg --list-parsers` to see supported formats. If your bank isn't listed, the tool uses content detection - it may still work if the format is similar.

## Development

```bash
# Install dev dependencies
uv pip install -e ".[dev]"

# Run tests
pytest

# Type check
mypy src

# Lint
ruff check src tests
```

## License

MIT
